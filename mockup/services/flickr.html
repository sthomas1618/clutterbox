#!/usr/bin/env ruby
require 'open-uri'
require 'json'

puts "Content-type: text/html"
puts
puts "<!DOCTYPE html>"
puts "<html>"
puts "<head>"
puts "  <title>ClutterBox</title>"
puts "  <meta charset=\"utf-8\">"
puts "  <link rel=\"stylesheet\" type=\"text/css\" href=\"../stylesheets/custom.css\">"
puts "</head>"
puts "<body>"
puts "  <header class=\"navHeader\">"
puts "    <div class=\"content navContent\">"
puts "      <a id=\"logo\">ClutterBox</a>"
puts "      <nav>"
puts "        <ul>"
puts "          <li><a href=\"../index.html\">Home</a></li>"
puts "          <li><a href=\"../bookmarks/popular.html\">Popular</a></li>"
puts "          <li><a href=\"chico.html\">Tags</a></li>"
puts "          <li><a href=\"../login.html\">Sign In</a></li>"
puts "        </ul>"
puts "      </nav>"
puts "    </div>"
puts "  </header>"
puts "  <div class=\"content\">"
puts "    <h1>Service: <span class=\"headerTag\">Flickr</span></h1>"
puts "    <section id=\"bookmarks\" class=\"feed\">"      
puts "<br>"

puts "Hello dynamic world --  #{Time.now}"

base = "api.flickr.com/services/rest/" 
method = "flickr.interestingness.getList"
key = "93495371bb07d95434cc9c821fec740c"
data =  JSON.parse(open("http://#{base}?method=#{method}&api_key=#{key}&per_page=20&format=json&nojsoncallback=1").read)

photos = data["photos"]["photo"]

photos.each do |p|
	href = "http://www.flickr.com/photos/#{p["owner"]}/#{p["id"]}"
	image = "http://farm#{p["farm"]}.staticflickr.com/#{p["server"]}/#{p["id"]}_#{p["secret"]}_m.jpg"
	puts "<article>"
  puts "<h3>"
  puts "<a href=\"#{href}\"> #{p["title"]} </a>"
  puts "</h3>"
  puts "<div>"      
  puts "<a href=\"#{href}\">#{href}</a>"
  puts "<span> 5 stars </span>"
  puts "<p>"
  puts "<img src=\"#{image}\" >"
  puts "</p>"
  puts "</div>"
  puts "</article>"
end

puts "    </section>"
puts "  </div>"
puts "  <footer id=\"footer\">"
puts "    &copy; Copyright Stephen Thomas 2012"
puts "  </footer>"
puts "</body>"
puts "</html>"
